<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admissions - Sethupathy Government Arts College</title>
  <link rel="stylesheet" type="text/css" href="./css/admission.css">
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    .success-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6); z-index: 9999;
      display: flex; align-items: center; justify-content: center;
      animation: fadeIn 0.3s ease;
    }
    .success-popup {
      background: white; padding: 50px 40px; border-radius: 20px;
      text-align: center; max-width: 550px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      border-top: 5px solid #27ae60;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1;} }
  </style>
</head>
<body>
  <section class="application-section">
    <div class="container">
      <div class="form-container">
        <div class="form-header">
          <h2><i class="fas fa-edit"></i> Online Application Form</h2>
          <p>Please fill in all the required details to apply for admission</p>
        </div>
      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" title="Form submission handler"></iframe>

        <form id="admissionForm" 
              action="https://docs.google.com/forms/d/e/1FAIpQLSfsxZYylaSxkW6Tip6Su0mBD2D0fRmUEPsca81yV7R5M-Gqvw/viewform" 
              method="POST" 
              target="hidden_iframe" 
              onsubmit="return submitForm(event)">
          
          <!-- Personal Information -->
          <div class="form-section">
            <h3><i class="fas fa-user"></i> Personal Information</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="fullName">Name *</label>
                <input type="text" id="fullName" name="entry.2005620554" required placeholder="Enter your full name">
              </div>
              <div class="form-group">
                <label for="dob">Date Of Birth *</label>
                <input type="date" id="dob" name="entry.1870886290" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="gender">Gender *</label>
                <select id="gender" name="entry.1375626670" required>
                  <option value="">Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Prefer not to say">Prefer not to say</option>
                </select>
              </div>
              <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="entry.1045781291" required placeholder="your.email@example.com">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="phone">Phone number *</label>
                <input type="tel" id="phone" name="entry.1166974658" required placeholder="10-digit mobile number" maxlength="10">
              </div>
              <div class="form-group">
                <label for="address">Address *</label>
                <textarea id="address" name="entry.1065046570" required placeholder="Enter your complete permanent address" rows="2"></textarea>
              </div>
            </div>
          </div>

          <!-- Course Selection -->
          <div class="form-section">
            <h3><i class="fas fa-graduation-cap"></i> Course Selection</h3>
            <div class="form-group">
              <label for="course">Course Applying for *</label>
              <select id="course" name="entry.479499184" required onchange="updateReferencePreview()">
                <option value="">Select Course</option>
                <option value="B.Com (general)" data-code="BCOMGEN">B.Com (general)</option>
                <option value="B.Com (Computer Application)" data-code="BCOMCA">B.Com (Computer Application)</option>
                <option value="B.A Tamil" data-code="BATAM">B.A Tamil</option>
                <option value="B.A English" data-code="BAENG">B.A English</option>
                <option value="B.Sc Mathematics" data-code="BSCMATH">B.Sc Mathematics</option>
                <option value="B.Sc Zoology" data-code="BSCZOO">B.Sc Zoology</option>
                <option value="B.Sc Physics" data-code="BSCPHY">B.Sc Physics</option>
                <option value="B.Sc Computer Science" data-code="BSCCS">B.Sc Computer Science</option>
                <option value="B.Sc Chemistry" data-code="BSCCHE">B.Sc Chemistry</option>
                <option value="B.Sc" data-code="BSC">B.Sc</option>
              </select>
              <div id="referencePreview" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 5px; display: none;">
                <small style="color: #0369a1;">Your Reference ID will be: <strong id="refIdPreview">SGAC---000001</strong></small>
              </div>
            </div>
          </div>

          <!-- Academic & Parent Details -->
          <div class="form-section">
            <h3><i class="fas fa-list-ol"></i> Academic & Parent Details</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="passYear">Year Of Passing *</label>
                <select id="passYear" name="entry.347061347" required>
                  <option value="">Select Year</option>
                  <option value="2026">2026</option>
                  <option value="2025">2025</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                </select>
              </div>
              <div class="form-group">
                <label for="percentage12">12th Mark *</label>
                <input type="number" id="percentage12" name="entry.1099822669" required min="35" max="100" step="0.01" placeholder="Enter percentage">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="percentage10">10th Mark *</label>
                <input type="number" id="percentage10" name="entry.1416808419" required min="35" max="100" step="0.01" placeholder="Enter percentage">
              </div>
              <div class="form-group">
                <label for="tcNumber">TC Number *</label>
                <input type="text" id="tcNumber" name="entry.2136875474" required placeholder="Transfer Certificate Number">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="incomeNumber">Income Number *</label>
                <input type="text" id="incomeNumber" name="entry.1664324858" required placeholder="Income Certificate Number">
              </div>
              <div class="form-group">
                <label for="communityNumber">Community Number</label>
                <input type="text" id="communityNumber" name="entry.1434001217" placeholder="Community Certificate Number (optional)">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="parentName">Parent Name *</label>
                <input type="text" id="parentName" name="entry.1878976567" required placeholder="Parent full name">
              </div>
              <div class="form-group">
                <label for="parentNumber">Parent Number *</label>
                <input type="tel" id="parentNumber" name="entry.2140741521" required placeholder="Parent contact number" maxlength="10">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="relationship">Parent Relationship *</label>
                <select id="relationship" name="entry.297892273" required>
                  <option value="">Select Relationship</option>
                  <option value="Father">Father</option>
                  <option value="Mother">Mother</option>
                  <option value="Guardian">Guardian</option>
                </select>
              </div>
              <div class="form-group">
                <label for="otherDetails">Other Details</label>
                <textarea id="otherDetails" name="entry.1726883402" placeholder="Any additional information" rows="2"></textarea>
              </div>
            </div>
          </div>
          <div class="form-submit">
            <button type="submit" class="submit-btn" id="submitButton">
              <i class="fas fa-paper-plane"></i>
              Submit Application
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script>
    let submissionInProgress = false;
    let currentReferenceId = '';

    const departmentCounters = {
      'BCOMGEN': 1, 'BCOMCA': 1, 'BATAM': 1, 'BAENG': 1, 'BSCMATH': 1,
      'BSCZOO': 1, 'BSCPHY': 1, 'BSCCS': 1, 'BSCCHE': 1, 'BSC': 1
    };

    function loadCounters() {
      const saved = localStorage.getItem('sgac_dept_counters');
      if (saved) Object.assign(departmentCounters, JSON.parse(saved));
    }
    function saveCounters() {
      localStorage.setItem('sgac_dept_counters', JSON.stringify(departmentCounters));
    }
    function generateReferenceId(courseCode) {
      const counter = departmentCounters[courseCode] || 1;
      return `SGAC${courseCode}${counter.toString().padStart(6, '0')}`;
    }
    function updateReferencePreview() {
      const courseSelect = document.getElementById('course');
      const preview = document.getElementById('referencePreview');
      const refIdPreview = document.getElementById('refIdPreview');
      if (courseSelect.value) {
        const selectedOption = courseSelect.options[courseSelect.selectedIndex];
        const courseCode = selectedOption.getAttribute('data-code');
        const refId = generateReferenceId(courseCode);
        refIdPreview.textContent = refId;
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }
    function handleIframeLoad() {
      if (submissionInProgress) {
        submissionInProgress = false;
        showSuccess(currentReferenceId);
        document.getElementById('admissionForm').reset();
        document.getElementById('referencePreview').style.display = 'none';
        const submitBtn = document.getElementById('submitButton');
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Application';
        submitBtn.disabled = false;
      }
    }
    function submitForm(event) {
      const submitBtn = document.getElementById('submitButton');
      const courseSelect = document.getElementById('course');
      const selectedOption = courseSelect.options[courseSelect.selectedIndex];
      const courseCode = selectedOption.getAttribute('data-code');
      currentReferenceId = generateReferenceId(courseCode);

      const otherDetailsField = document.getElementById('otherDetails');
      const currentValue = otherDetailsField.value || '';
      otherDetailsField.value = currentValue + `\n\nReference ID: ${currentReferenceId}`;

      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
      submitBtn.disabled = true;

      submissionInProgress = true;
      departmentCounters[courseCode]++;
      saveCounters();
      setTimeout(() => {
        if (submissionInProgress) handleIframeLoad();
      }, 5000);
      return true;
    }
    function showSuccess(referenceId) {
      const overlay = document.createElement('div');
      overlay.className = 'success-overlay';
      const popup = document.createElement('div');
      popup.className = 'success-popup';
      popup.innerHTML = `
        <i class="fas fa-check-circle" style="font-size: 4rem; color: #27ae60; margin-bottom: 25px;"></i>
        <h3 style="color: #2c3e50; font-size: 1.8rem; margin-bottom: 20px; font-weight: 700;">Application Submitted Successfully! 🎉</h3>
        <p style="color: #666; margin-bottom: 25px; font-size: 1.1rem;">Thank you for your application to <strong>Sethupathy Government Arts College</strong>.</p>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
          <p style="color: #2c3e50; margin-bottom: 10px; font-weight: 600;"><strong>📝 Application Reference ID:</strong></p>
          <p style="color: #27ae60; font-size: 1.4rem; font-weight: 700; font-family: monospace; letter-spacing: 1px;">${referenceId}</p>
          <p style="color: #666; font-size: 0.9rem; margin: 10px 0 0 0;">Please save this ID for future reference.</p>
        </div>
        <button onclick="closePopup()" style="background: #27ae60; color: white; padding: 15px 35px; border: none; border-radius: 50px; cursor: pointer; font-weight: 600;">Close & Continue</button>
      `;
      overlay.appendChild(popup);
      document.body.appendChild(overlay);
      window.closePopup = function() { overlay.remove(); };
    }
    document.addEventListener('DOMContentLoaded', function() {
      loadCounters();
      document.getElementById('hidden_iframe').onload = handleIframeLoad;
      ['phone', 'parentNumber'].forEach(id => {
        document.getElementById(id).addEventListener('input', function() {
          this.value = this.value.replace(/\D/g, '').substr(0, 10);
        });
      });
    });
  </script>
</body>
</html>
